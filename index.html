<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>COLOREDATOM – Neon Atom Arena</title>



<style>
html,body{margin:0;padding:0;overflow:hidden;background:#05060a;font-family:Inter,system-ui,sans-serif;cursor:auto}
#startScreen,#endScreen{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:100}
#startScreen{background:radial-gradient(circle at top,#10162f,#05060a 70%)}
#endScreen{background:radial-gradient(circle at top,#0b2a2a,#020408 70%);display:none;color:#fff;text-align:center}
.title{font-size:64px;font-weight:900;background:linear-gradient(90deg,#4dfcff,#ff5fa2,#ffe066);background-size:200%;-webkit-background-clip:text;background-clip:text;color:transparent;animation:grad 4s linear infinite}
@keyframes grad{0%{background-position:0%}100%{background-position:200%}}
button{margin-top:16px;padding:14px 36px;font-size:18px;border-radius:14px;border:none;cursor:pointer;font-weight:700}
#lvl1{background:linear-gradient(135deg,#4dfcff,#ff5fa2)}
#lvl2{background:linear-gradient(135deg,#ff5fa2,#ffe066)}
#ui{position:fixed;top:16px;left:16px;color:#fff;z-index:10;font-size:13px}
#ui button{margin-top:6px;margin-right:6px;padding:6px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;background:#222;color:#fff}
</style>
</head>
<body>

<div id="startScreen">
  <div class="title">COLOREDATOM BALL</div>
  <button id="lvl1">LEVEL 1</button>
  <button id="lvl2">LEVEL 2</button>
</div>

<div id="ui">
  WASD move · Space jump · Mouse look<br/>
  <button id="resetBtn">Restart</button>
  <button id="nextBtn">Next Level</button>
</div>

<div id="endScreen">
  <h1 class="title">LEVEL COMPLETED</h1>
  <div id="stats"></div>
  <button id="again">Play Again</button>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";

// ===== BASIC SETUP =====
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x05060a);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
// initial camera position so mobile doesn't render black
camera.position.set(0,6,18);
camera.lookAt(0,2,0);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.setSize(innerWidth, innerHeight);
renderer.domElement.style.position='fixed';
renderer.domElement.style.inset='0';
renderer.domElement.style.width='100%';
renderer.domElement.style.height='100%';
document.body.appendChild(renderer.domElement);

addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});

scene.add(new THREE.AmbientLight(0x6666ff,0.6));
const sun=new THREE.DirectionalLight(0xffffff,1.2);
sun.position.set(30,60,20);
scene.add(sun);

// ===== DATA =====
const colorsLevel1=[0x4dfcff,0xff5fa2,0xffc857,0x7cff6b,0xb86cff];
let lives=3;
let currentLevel=1;
let gameStarted=false;
const blocks=[];
const dynamicBlocks=[];

// ===== FLOOR =====
const floor=new THREE.Mesh(
  new THREE.BoxGeometry(80,2,80),
  new THREE.MeshStandardMaterial({color:0x111a33})
);
floor.position.y=-1;
floor.userData={half:40,halfH:1};
scene.add(floor);

// ===== START BLOCK =====
const startBlock=new THREE.Mesh(
  new THREE.BoxGeometry(4,2,4),
  new THREE.MeshStandardMaterial({color:0xff5fa2,emissive:0xff5fa2})
);
startBlock.userData={half:2,halfH:1};
scene.add(startBlock);

// ===== GOAL =====
const goal=new THREE.Mesh(
  new THREE.CylinderGeometry(1.2,1.2,3,24),
  new THREE.MeshStandardMaterial({color:0x00ff9c,emissive:0x00ff9c})
);
goal.visible=false;
scene.add(goal);

// ===== PLAYER =====
const radius=0.8;
const player=new THREE.Mesh(
  new THREE.SphereGeometry(radius,32,32),
  new THREE.MeshStandardMaterial({color:0x4dfcff,emissive:0x1aa3a3})
);
scene.add(player);

// ===== HELPERS =====
function createBlock(x,y,z,size,color){
  const h=2;
  const b=new THREE.Mesh(
    new THREE.BoxGeometry(size,h,size),
    new THREE.MeshStandardMaterial({color,emissive:color})
  );
  b.position.set(x,y,z);
  b.userData={half:size/2,halfH:h/2};
  scene.add(b);
  blocks.push(b);
  return b;
}

function clearLevel(){
  blocks.forEach(b=>scene.remove(b));
  dynamicBlocks.length=0;
  blocks.length=0;
  scene.add(floor);
  scene.add(startBlock);
  blocks.push(floor,startBlock);
}

// ===== LEVELS =====
function buildLevel1(){
  clearLevel();
  startBlock.position.set(0,2,10);
  let x=0,y=3,z=14;
  for(let i=0;i<30;i++){
    x+=i%2===0?4:-4;
    z+=5;
    createBlock(x,y,z,3,colorsLevel1[i%colorsLevel1.length]);
  }
  // place goal closer and easier to reach
goal.position.set(x,y+3,z+3);
  goal.visible=true;
}

function buildLevel2(){
  clearLevel();
  startBlock.position.set(0,2,10);

  // LEVEL 2: LONG LABYRINTH STYLE PARKOUR
  // Structured, separated blocks, maze-like and longer

  const palette=[0x4dfcff,0xff5fa2,0xffc857,0x7cff6b,0xb86cff];

  let x=0, y=3, z=14;
  const steps=70; // longer level

  for(let i=0;i<steps;i++){
    // create block
    createBlock(x,y,z,3,palette[i%palette.length]);

    // maze-like direction changes
    if(i%5===0){
      x += (i%10===0?6:-6);
    } else {
      z += 6;
    }

    // gentle vertical variation (no stacking)
    y = 3 + (i%6)*0.7;

    // dead-end branches (visual maze)
    if(i%8===0){
      createBlock(x+6,y,z,3,0x333333);
    }
  }

  // final helper block before goal
createBlock(x, y, z+3, 3, 0xff5fa2);

// goal placed close after final block
goal.position.set(x, y+4, z+6);
  goal.visible=true;
}

function loadLevel(lvl){lvl===1?buildLevel1():buildLevel2();}

// ===== CONTROLS =====

// --- MOBILE DETECTION ---
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

let touchForward=false, touchBack=false, touchLeft=false, touchRight=false;
let lastTouchX=null;

const keys={};
let yaw=0,vy=0,isGrounded=false;
const gravity=-0.025,jump=0.5;

addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
// reduced mouse sensitivity
addEventListener('mousemove',e=>{ if(!isMobile) yaw-=e.movementX*0.015; });

// --- MOBILE TOUCH LOOK ---
addEventListener('touchmove',e=>{
  if(!isMobile) return;
  const t=e.touches[0];
  if(lastTouchX!==null){ yaw -= (t.clientX-lastTouchX)*0.01; }
  lastTouchX=t.clientX;
},{passive:true});

addEventListener('touchend',()=>lastTouchX=null);


// ===== UI =====
lvl1.onclick=()=>startGame(1);
lvl2.onclick=()=>startGame(2);
resetBtn.onclick=()=>resetPlayer();
nextBtn.onclick=()=>{currentLevel=currentLevel===1?2:1;startGame(currentLevel);};
again.onclick=()=>{endScreen.style.display='none';startScreen.style.display='flex';document.body.style.cursor='auto';};

let startTime=0;
function startGame(lvl){
  document.body.style.cursor='none';
  startTime=performance.now();
  currentLevel=lvl;
  lives=3;
  gameStarted=true;
  startScreen.style.display='none';
  resetPlayer();
  loadLevel(lvl);
}

function resetPlayer(){player.position.set(startBlock.position.x, startBlock.position.y+2, startBlock.position.z);vy=0;}

function loseLife(){lives--;resetPlayer();if(lives<=0){gameStarted=false;startScreen.style.display='flex';document.body.style.cursor='auto';}}

function endGame(){
  gameStarted=false;
  const t=((performance.now()-startTime)/1000).toFixed(2);
  stats.innerHTML=`<p>Level: ${currentLevel}</p><p>Time: ${t}s</p><p>Lives left: ${lives}</p>`;
  endScreen.style.display='flex';
}

// ===== LOOP =====
// --- MOBILE JOYSTICK + JUMP ---
if(isMobile){
  let joyX=0, joyY=0, jumping=false;

  const joy=document.createElement('div');
  joy.style.cssText=`position:fixed;left:20px;bottom:20px;width:140px;height:140px;border-radius:50%;background:rgba(255,255,255,0.08);z-index:200;touch-action:none;`;

  const knob=document.createElement('div');
  knob.style.cssText=`position:absolute;left:50%;top:50%;width:60px;height:60px;margin:-30px;border-radius:50%;background:rgba(255,255,255,0.4);`;
  joy.appendChild(knob);
  document.body.appendChild(joy);

  joy.addEventListener('touchstart',e=>e.preventDefault());
  joy.addEventListener('touchmove',e=>{
    const t=e.touches[0];
    const r=joy.getBoundingClientRect();
    const dx=t.clientX-(r.left+r.width/2);
    const dy=t.clientY-(r.top+r.height/2);
    const d=Math.min(50,Math.hypot(dx,dy));
    const a=Math.atan2(dy,dx);
    joyX=Math.cos(a)*(d/50);
    joyY=Math.sin(a)*(d/50);
    knob.style.transform=`translate(${joyX*40}px,${joyY*40}px)`;
  });
  joy.addEventListener('touchend',()=>{joyX=joyY=0;knob.style.transform='translate(0,0)';});

  const jumpBtn=document.createElement('button');
  jumpBtn.innerText='⤒';
  jumpBtn.style.cssText=`position:fixed;right:30px;bottom:40px;width:80px;height:80px;border-radius:50%;font-size:32px;border:none;background:linear-gradient(135deg,#4dfcff,#ff5fa2);color:#000;z-index:200;`;
  document.body.appendChild(jumpBtn);
  jumpBtn.ontouchstart=()=>jumping=true;
  jumpBtn.ontouchend=()=>jumping=false;

  window.mobileInput={joyX:()=>joyX, joyY:()=>joyY, jump:()=>jumping};
}

function animate(){
  requestAnimationFrame(animate);
  if(!gameStarted){renderer.render(scene,camera);return;}

  const dir=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
  // forward / backward
  if(keys.w) player.position.addScaledVector(dir,0.14);
  if(keys.s) player.position.addScaledVector(dir,-0.14);

  // strafe left / right
  const right = new THREE.Vector3(dir.z, 0, -dir.x);
  if(keys.a) player.position.addScaledVector(right,0.14);
  if(keys.d) player.position.addScaledVector(right,-0.14);

  // mobile joystick movement
  if(isMobile && window.mobileInput){
    player.position.addScaledVector(dir, -window.mobileInput().joyY()*0.18);
    player.position.addScaledVector(right, window.mobileInput().joyX()*0.18);
  }

  vy+=gravity;
  player.position.y+=vy;
  isGrounded=false;

  blocks.forEach(b=>{
    const dx=Math.abs(player.position.x-b.position.x);
    const dz=Math.abs(player.position.z-b.position.z);
    const top=b.position.y+b.userData.halfH;
    if(dx<b.userData.half+radius && dz<b.userData.half+radius){
      if(vy<=0 && player.position.y-radius<=top && player.position.y>top){
        player.position.y=top+radius;vy=0;isGrounded=true;
      }
    }
  });

  if((keys[' '] || (isMobile && window.mobileInput && window.mobileInput().jump())) && isGrounded) vy=jump;
  if(player.position.y<-10) loseLife();

  dynamicBlocks.forEach(d=>{
    const nx=d.baseX+Math.sin(performance.now()*0.002)*3;
    const dx=nx-d.mesh.position.x;
    d.mesh.position.x=nx;
    if(isGrounded) player.position.x+=dx;
  });

  if(goal.visible && player.position.distanceTo(goal.position)<1.8) endGame();

  camera.position.set(player.position.x-10*Math.sin(yaw),player.position.y+4,player.position.z-10*Math.cos(yaw));
  camera.lookAt(player.position);

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
