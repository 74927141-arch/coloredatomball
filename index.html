<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>COLOREDATOM – Neon Atom Arena</title>

<style>
html,body{margin:0;padding:0;overflow:hidden;background:#05060a;font-family:Inter,system-ui,sans-serif}
#startScreen,#endScreen{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:100}
#startScreen{background:radial-gradient(circle at top,#10162f,#05060a 70%)}
#endScreen{background:radial-gradient(circle at top,#0b2a2a,#020408 70%);display:none;color:#fff;text-align:center}
.title{font-size:56px;font-weight:900;background:linear-gradient(90deg,#4dfcff,#ff5fa2,#ffe066);background-size:200%;-webkit-background-clip:text;background-clip:text;color:transparent;animation:grad 4s linear infinite}
@keyframes grad{0%{background-position:0%}100%{background-position:200%}}
button{margin-top:16px;padding:14px 36px;font-size:18px;border-radius:14px;border:none;cursor:pointer;font-weight:700}
#lvl1{background:linear-gradient(135deg,#4dfcff,#ff5fa2)}
#lvl2{background:linear-gradient(135deg,#ff5fa2,#ffe066)}
#ui{position:fixed;top:12px;left:12px;color:#fff;z-index:10;font-size:12px}
#ui button{margin-top:6px;margin-right:6px;padding:6px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;background:#222;color:#fff}

/* MOBILE CONTROLS */
#mobileControls{position:fixed;inset:0;pointer-events:none;z-index:50;display:none}
#joystick{position:absolute;left:20px;bottom:20px;width:140px;height:140px;border-radius:50%;background:rgba(255,255,255,0.08);pointer-events:auto}
#stick{position:absolute;left:50%;top:50%;width:60px;height:60px;margin:-30px;border-radius:50%;background:rgba(255,255,255,0.35)}
#jumpBtn{position:absolute;right:20px;bottom:40px;width:100px;height:100px;border-radius:50%;font-weight:900;background:linear-gradient(135deg,#4dfcff,#ff5fa2);pointer-events:auto}
</style>
</head>
<body>

<div id="startScreen">
  <div class="title">COLOREDATOM BALL</div>
  <button id="lvl1">LEVEL 1</button>
  <button id="lvl2">LEVEL 2</button>
</div>

<div id="ui">
  Move · Jump<br/>
  <button id="resetBtn">Restart</button>
  <button id="nextBtn">Next Level</button>
</div>

<div id="endScreen">
  <h1 class="title">LEVEL COMPLETED</h1>
  <div id="stats"></div>
  <button id="again">Play Again</button>
</div>

<!-- MOBILE -->
<div id="mobileControls">
  <div id="joystick"><div id="stick"></div></div>
  <button id="jumpBtn">JUMP</button>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";

// BASIC
const scene=new THREE.Scene();scene.background=new THREE.Color(0x05060a);
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,6,18);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);
addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});
scene.add(new THREE.AmbientLight(0x6666ff,0.6));const sun=new THREE.DirectionalLight(0xffffff,1.2);sun.position.set(30,60,20);scene.add(sun);

// GAME DATA
const colors=[0x4dfcff,0xff5fa2,0xffc857,0x7cff6b,0xb86cff];
let lives=3,currentLevel=1,gameStarted=false;const blocks=[];

// FLOOR
const floor=new THREE.Mesh(new THREE.BoxGeometry(120,2,120),new THREE.MeshStandardMaterial({color:0x111a33}));floor.position.y=-1;floor.userData={half:60,halfH:1};scene.add(floor);

// START BLOCK
const startBlock=new THREE.Mesh(new THREE.BoxGeometry(4,2,4),new THREE.MeshStandardMaterial({color:0xff5fa2,emissive:0xff5fa2}));startBlock.userData={half:2,halfH:1};scene.add(startBlock);

// GOAL
const goal=new THREE.Mesh(new THREE.CylinderGeometry(1.2,1.2,3,24),new THREE.MeshStandardMaterial({color:0x00ff9c,emissive:0x00ff9c}));goal.visible=false;scene.add(goal);

// PLAYER
const radius=0.8;
const player=new THREE.Mesh(new THREE.SphereGeometry(radius,32,32),new THREE.MeshStandardMaterial({color:0x4dfcff,emissive:0x1aa3a3}));scene.add(player);

function createBlock(x,y,z,s,c){const b=new THREE.Mesh(new THREE.BoxGeometry(s,2,s),new THREE.MeshStandardMaterial({color:c,emissive:c}));b.position.set(x,y,z);b.userData={half:s/2,halfH:1};scene.add(b);blocks.push(b)}
function clearLevel(){blocks.forEach(b=>scene.remove(b));blocks.length=0;blocks.push(floor,startBlock)}

function buildLevel1(){clearLevel();startBlock.position.set(0,2,10);let x=0,y=3,z=14;for(let i=0;i<30;i++){x+=i%2===0?4:-4;z+=5;createBlock(x,y,z,3,colors[i%colors.length])}goal.position.set(x,y+3,z+4);goal.visible=true}
function buildLevel2(){clearLevel();startBlock.position.set(0,2,10);let x=0,y=3,z=14;for(let i=0;i<50;i++){createBlock(x,y,z,3,colors[i%colors.length]);if(i%3===0)x+=6;else z+=6;y=3+(i%4)*0.7}goal.position.set(x,y+4,z+6);goal.visible=true}
function loadLevel(l){l===1?buildLevel1():buildLevel2()}

// CONTROLS
const isMobile=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
if(isMobile) document.getElementById('mobileControls').style.display='block';
const keys={};let yaw=0,vy=0,isGrounded=false;const gravity=-0.025,jump=0.5;
addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
addEventListener('mousemove',e=>{if(!isMobile) yaw-=e.movementX*0.015});

// MOBILE JOYSTICK
let joyX=0,joyY=0;const joy=document.getElementById('joystick'),stick=document.getElementById('stick');
function joyMove(e){const t=e.touches[0];const r=joy.getBoundingClientRect();const x=t.clientX-(r.left+r.width/2);const y=t.clientY-(r.top+r.height/2);const m=40;joyX=Math.max(-1,Math.min(1,x/m));joyY=Math.max(-1,Math.min(1,y/m));stick.style.transform=`translate(${joyX*40}px,${joyY*40}px)`}
if(isMobile){joy.addEventListener('touchstart',joyMove);joy.addEventListener('touchmove',joyMove);joy.addEventListener('touchend',()=>{joyX=joyY=0;stick.style.transform='translate(0,0)'})}
document.getElementById('jumpBtn').addEventListener('touchstart',()=>{if(isGrounded) vy=jump});

// UI
lvl1.onclick=()=>startGame(1);lvl2.onclick=()=>startGame(2);
resetBtn.onclick=resetPlayer;nextBtn.onclick=()=>startGame(currentLevel===1?2:1);
again.onclick=()=>{endScreen.style.display='none';startScreen.style.display='flex'};
let startTime=0;
function startGame(l){currentLevel=l;lives=3;gameStarted=true;startScreen.style.display='none';startTime=performance.now();resetPlayer();loadLevel(l)}
function resetPlayer(){player.position.set(startBlock.position.x,startBlock.position.y+2,startBlock.position.z);vy=0}
function loseLife(){lives--;resetPlayer();if(lives<=0){gameStarted=false;startScreen.style.display='flex'}}
function endGame(){gameStarted=false;const t=((performance.now()-startTime)/1000).toFixed(2);stats.innerHTML=`<p>Level ${currentLevel}</p><p>Time ${t}s</p><p>Lives ${lives}</p>`;endScreen.style.display='flex'}

// LOOP
function animate(){requestAnimationFrame(animate);if(!gameStarted){renderer.render(scene,camera);return}
const dir=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw)),right=new THREE.Vector3(dir.z,0,-dir.x);
if(keys.w||joyY<-0.2) player.position.addScaledVector(dir,0.16);
if(keys.s||joyY>0.2) player.position.addScaledVector(dir,-0.16);
if(keys.a||joyX<-0.2) player.position.addScaledVector(right,0.16);
if(keys.d||joyX>0.2) player.position.addScaledVector(right,-0.16);
vy+=gravity;player.position.y+=vy;isGrounded=false;
blocks.forEach(b=>{const dx=Math.abs(player.position.x-b.position.x),dz=Math.abs(player.position.z-b.position.z),top=b.position.y+b.userData.halfH;if(dx<b.userData.half+radius&&dz<b.userData.half+radius){if(vy<=0&&player.position.y-radius<=top&&player.position.y>top){player.position.y=top+radius;vy=0;isGrounded=true}}});
if(keys[' ']&&isGrounded) vy=jump;if(player.position.y<-10) loseLife();
if(goal.visible&&player.position.distanceTo(goal.position)<1.8) endGame();
camera.position.set(player.position.x-10*Math.sin(yaw),player.position.y+4,player.position.z-10*Math.cos(yaw));camera.lookAt(player.position);
renderer.render(scene,camera)}
animate();
</script>
</body>
</html>
